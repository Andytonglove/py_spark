### 基于Spark的车辆轨迹分析

#### 主要内容  
利用大数据工具Spark，综合采用课程中介绍的方法进行车辆轨迹的初步分析，包括车辆停留点分析、加减速监测等。  
本次课程设计使用课程实习过程中搭建的Windows下的Spark环境，采用Python编程。  
数据采用微软的车辆轨迹数据-Geolife Trajectories中的编号为170号的车辆轨迹数据。  


#### 完成的分析功能
车辆轨迹分析应实现如下三种功能：
1. 车辆速率计算  
    从原始轨迹数据中获取每个轨迹点的经纬度坐标，通过该轨迹点与前一个点的距离和两个轨迹点的时间差，计算该点的即时速率。根据实际意义，规定起点和终点的即时速率为零。
2. 车辆停留点分析  
    停留点识别的算法描述如下：  
    - 遍历轨迹点，检查速率值，若小于阈值，则将上一个点作为停留开始点，记录其序号。
    - 继续遍历轨迹点，只要轨迹点的速率值仍小于阈值，则将该点作为停留点。
3. 车辆加减速分析  
    加速和减速都是持续性的过程，而突发的速率变化则可能是数据采集或预处理阶段的误差引起的正常波动，因此加/减速检测方法可以采用寻找至少连续N（N ≥ 2）个点速率单调变化的片段。  


#### 代码程序说明
1. speedCalc(lng1, lat1, lng2, lat2, timelag)为通过经纬度与时间差计算速度的数据处理函数；  

2. calSpeed(df)为进行车辆速率计算的函数，接收参数为dataframe，返回计算得到的dataframe；  

3. calStopPoints(df, limit)为进行车辆停留点分析的函数，接收参数为dataframe和阈值，返回计算得到的dataframe；  

4. calAcceleration(df)为进行车辆加减速分析的函数，接收参数为dataframe，返回计算得到的dataframe；  

5. main为主程序，其中读取文件采用相对路径读取170号车辆数据的20080428112704.plt文件作为代表，读入数据文件并进行一些预处理操作，随后依次调用上述函数进行分析，实现全部分析并最后组织输出结果在控制台和result.csv中。  


#### 运行结果说明
运行结果以dataframe形式输出在文件**result.csv**中。其中：
1. 车辆速率计算：可见车辆点速度列，其速度单位为m/s；  
2. 车辆停留点分析：在控制台中打印输出；同时可见停留点列，停留点标记中，1为停留点，0为非停留点；  
3. 车辆加减速分析：在控制台中打印输出；同时可见加减速区间分析列，在加速列中为True即为点在加速区间中，减速列中亦然。  
4. 控制台输出结果拷贝保存在文件**控制台输出结果.txt**中。